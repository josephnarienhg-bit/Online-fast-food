<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HAARY JANCY EMPIRE - Restaurant Menu & Billing</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs@gh-pages/qrcode.min.js" defer></script>
    <script>
        // If not logged in, send user to login page first (keeps login page first).
        (function(){
            try {
                const current = localStorage.getItem('currentUser');
                const path = window.location.pathname.split('/').pop().toLowerCase();
                if (!current && path !== 'login.html') {
                    window.location.href = 'login.html';
                }
            } catch(e){ /* ignore */ }
        })();
    </script>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="header-brand">
            <!-- Professional Logo -->
            <svg class="header-logo" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                <!-- Plate -->
                <circle cx="100" cy="100" r="90" fill="none" stroke="#667eea" stroke-width="2" opacity="0.3"/>
                <circle cx="100" cy="100" r="85" fill="#667eea" opacity="0.05"/>
                
                <!-- Fork -->
                <path d="M 60 60 L 60 140 Q 60 150 70 150 L 130 150 Q 140 150 140 140 L 140 60" 
                      fill="none" stroke="#667eea" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                
                <!-- Tines -->
                <line x1="75" y1="60" x2="75" y2="135" stroke="#667eea" stroke-width="3" stroke-linecap="round"/>
                <line x1="100" y1="60" x2="100" y2="135" stroke="#667eea" stroke-width="3" stroke-linecap="round"/>
                <line x1="125" y1="60" x2="125" y2="135" stroke="#667eea" stroke-width="3" stroke-linecap="round"/>
            </svg>
            <h1>HAARY JANCY EMPIRE</h1>
        </div>
        <div class="header-search">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M21 21l-4.35-4.35" stroke="#333" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><circle cx="11" cy="11" r="6" stroke="#333" stroke-width="2"></circle></svg>
            <input id="headerSearchInput" type="search" placeholder="Search menu items..." aria-label="Search menu items">
        </div>
        <div class="header-actions">
            <button id="manageMenuBtn" class="btn-secondary">Manage Menu</button>
            <button id="salesReportBtn" class="btn-secondary">Sales Report</button>
            <button id="orderHistoryBtn" class="btn-secondary">üìã My Orders</button>
            <button id="settingsBtn" class="btn-secondary">‚öôÔ∏è Settings</button>
            <a href="login.html" id="loginLink" class="btn-secondary" style="text-decoration:none; display:inline-flex; align-items:center; justify-content:center;">Login</a>
            <button id="cartToggleBtn" class="btn-primary">
                Cart <span id="cartCount">0</span>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main>
        <!-- Menu Section -->
        <section id="menuSection" class="menu-section">
            <h2>Our Menu</h2>
            <div id="menuGrid" class="menu-grid">
                <!-- Menu items will be dynamically loaded here -->
            </div>
        </section>

        <!-- Cart & Billing Section -->
        <aside id="cartSection" class="cart-section">
            <div class="cart-header">
                <h2>Your Order</h2>
                <button id="closeCartBtn" class="close-btn">&times;</button>
            </div>
            <div id="cartItems" class="cart-items">
                <!-- Cart items will be dynamically loaded here -->
            </div>
            <div class="cart-footer">
                <div class="bill-summary">
                    <div class="bill-row">
                        <span>Subtotal:</span>
                        <span id="subtotal">‚Çπ0.00</span>
                    </div>
                    <div class="bill-row">
                        <span>Tax (5%):</span>
                        <span id="tax">‚Çπ0.00</span>
                    </div>
                    <div class="bill-row total">
                        <span>Total:</span>
                        <span id="total">‚Çπ0.00</span>
                    </div>
                </div>
                <div class="cart-actions">
                    <button id="clearCartBtn" class="btn-danger">Clear Cart</button>
                    <button id="printBillBtn" class="btn-secondary">Print Bill</button>
                    <button id="payNowBtn" class="btn-primary">Pay Now</button>
                </div>
            </div>
        </aside>

        <!-- QR Code Modal -->
        <div id="qrModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>Payment QR Code</h2>
                <div id="qrcode"></div>
                <p>Scan to complete payment</p>
                <p class="payment-amount">Amount: <span id="paymentAmount">‚Çπ0.00</span></p>
                <button id="closeQrModal" class="btn-primary">Close</button>
            </div>
        </div>

        <!-- Admin Panel (Menu Management) -->
        <section id="adminPanel" class="admin-panel">
            <div class="admin-header">
                <h2>Manage Menu</h2>
                <button id="closeAdminBtn" class="close-btn">&times;</button>
            </div>
            <div class="admin-content">
                <div class="add-item-form">
                    <h3>Add New Item</h3>
                    <form id="addItemForm">
                        <input type="text" id="itemName" placeholder="Item Name" required>
                            <input type="number" id="itemPrice" placeholder="Price (‚Çπ)" step="0.01" min="0" required>
                            <input type="file" id="itemImageFile" accept="image/*">
                            <input type="text" id="itemImage" placeholder="Image URL (optional, or choose a file above)">
                        <button type="submit" class="btn-primary">Add Item</button>
                    </form>
                </div>
                <div class="menu-items-list">
                    <h3>Current Menu Items</h3>
                    <div id="adminMenuList" class="admin-menu-list">
                        <!-- Admin menu items will be dynamically loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Sales Report Section -->
        <section id="salesReportSection" class="sales-report-section">
            <div class="report-header">
                <h2>Monthly Sales Report</h2>
                <button id="closeReportBtn" class="close-btn">&times;</button>
            </div>
            <div class="report-content">
                <div class="report-filters">
                    <label for="monthSelect">Select Month:</label>
                    <input type="month" id="monthSelect" value="">
                    <button id="generateReportBtn" class="btn-primary">Generate Report</button>
                </div>
                <div id="reportData" class="report-data">
                    <!-- Report data will be dynamically loaded here -->
                </div>
            </div>
        </section>
        
        <!-- Address Modal for placing orders -->
        <div id="addressModal" class="modal">
            <div class="modal-content">
                <span class="close-modal" id="closeAddressModal">&times;</span>
                <h2>Delivery Details</h2>
                <form id="addressForm">
                    <input type="text" id="custName" placeholder="Full name" required>
                    <input type="tel" id="custPhone" placeholder="Phone number" required>
                    <input type="text" id="custAddress" placeholder="Address line" required>
                    <input type="text" id="custCity" placeholder="City" required>
                    <input type="text" id="custPostal" placeholder="Postal code" required>
                    <div style="display:flex; gap:0.5rem; margin-top:0.75rem;">
                        <button id="placeOrderBtn" type="button" class="btn-primary">Place Order</button>
                        <button id="cancelAddressBtn" type="button" class="btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Payment Method Modal -->
        <div id="paymentMethodModal" class="modal">
            <div class="modal-content payment-method-modal">
                <span class="close-modal" id="closePaymentModal">&times;</span>
                <h2>Choose Payment Method</h2>
                <p style="text-align: center; color: #666; margin: 1rem 0;">How would you like to pay?</p>
                <div style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1.5rem;">
                    <button id="cashPaymentBtn" type="button" class="btn-payment-method payment-cash">
                        <span style="font-size: 2rem; margin-bottom: 0.5rem;">üíµ</span>
                        <strong>Cash Payment</strong>
                        <small style="display: block; font-size: 0.85rem; margin-top: 0.25rem;">Pay at delivery</small>
                    </button>
                    <button id="qrPaymentBtn" type="button" class="btn-payment-method payment-qr">
                        <span style="font-size: 2rem; margin-bottom: 0.5rem;">üì±</span>
                        <strong>QR Code Payment</strong>
                        <small style="display: block; font-size: 0.85rem; margin-top: 0.25rem;">Scan & pay now</small>
                    </button>
                </div>
            </div>
        </div>

        <!-- Order Confirmation Modal (Cash Payment) -->
        <div id="cashConfirmationModal" class="modal">
            <div class="modal-content confirmation-modal">
                <div class="success-checkmark">‚úì</div>
                <h2>Order Placed Successfully!</h2>
                <div id="cashOrderDetails" style="background: #f8f9ff; padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; text-align: left;">
                    <p style="margin: 0.5rem 0;"><strong>Order ID:</strong> <span id="cashOrderId"></span></p>
                    <p style="margin: 0.5rem 0;"><strong>Total Amount:</strong> <span id="cashOrderTotal"></span></p>
                    <p style="margin: 0.5rem 0;"><strong>Payment Method:</strong> Cash on Delivery</p>
                    <p style="margin: 0.5rem 0;"><strong>Delivery Address:</strong> <span id="cashDeliveryAddr"></span></p>
                </div>
                <p style="color: #666; margin: 1rem 0; text-align: center;">Your order will be delivered soon. You will receive a call from our delivery partner.</p>
                <button id="closeCashConfirmBtn" class="btn-primary" style="width: 100%;">Continue Shopping</button>
            </div>
        </div>

        <!-- Order Confirmation Modal (QR Payment) -->
        <div id="qrConfirmationModal" class="modal">
            <div class="modal-content confirmation-modal">
                <div class="success-checkmark">‚úì</div>
                <h2>Order Placed Successfully!</h2>
                <p style="color: #666; margin: 1rem 0; text-align: center;">Scan the QR code below to complete payment</p>
                <div id="qrcode" style="display: flex; justify-content: center; margin: 1.5rem 0; padding: 1rem; background: #f8f9ff; border-radius: 12px;"></div>
                <div id="qrOrderDetails" style="background: #f8f9ff; padding: 1.5rem; border-radius: 12px; margin: 1.5rem 0; text-align: left;">
                    <p style="margin: 0.5rem 0;"><strong>Order ID:</strong> <span id="qrOrderId"></span></p>
                    <p style="margin: 0.5rem 0;"><strong>Amount to Pay:</strong> <span id="qrOrderTotal"></span></p>
                    <p style="margin: 0.5rem 0;"><strong>Payment Method:</strong> QR Code</p>
                    <p style="margin: 0.5rem 0;"><strong>Delivery Address:</strong> <span id="qrDeliveryAddr"></span></p>
                </div>
                <button id="closeQrConfirmBtn" class="btn-primary" style="width: 100%;">Done</button>
            </div>
        </div>
    </main>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content settings-modal">
            <span class="close-modal" id="closeSettingsModal">&times;</span>
            <h2>‚öôÔ∏è Settings</h2>
            <p style="color: #666; margin-bottom: 1.5rem;">Update your profile information</p>
            
            <form id="settingsForm">
                <div class="form-group-settings">
                    <label for="settingsUsername">Username</label>
                    <input type="text" id="settingsUsername" placeholder="Username" readonly style="background: #f3f4f6; cursor: not-allowed;">
                    <small style="color: #999;">Username cannot be changed</small>
                </div>

                <div class="form-group-settings">
                    <label for="settingsName">Full Name</label>
                    <input type="text" id="settingsName" placeholder="Enter your full name">
                </div>

                <div class="form-group-settings">
                    <label for="settingsEmail">Email Address</label>
                    <input type="email" id="settingsEmail" placeholder="Enter your email">
                </div>

                <div class="form-group-settings">
                    <label for="settingsPhone">Phone Number</label>
                    <input type="tel" id="settingsPhone" placeholder="Enter your phone number">
                </div>

                <div class="form-group-settings">
                    <label for="settingsAddress">Default Address</label>
                    <textarea id="settingsAddress" placeholder="Enter your default address" style="resize: vertical; min-height: 80px;"></textarea>
                </div>

                <div style="display: flex; gap: 0.75rem; margin-top: 1.5rem;">
                    <button id="saveSettingsBtn" type="button" class="btn-primary" style="flex: 1;">Save Changes</button>
                    <button id="cancelSettingsBtn" type="button" class="btn-secondary" style="flex: 1;">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Order History Modal -->
    <div id="orderHistoryModal" class="modal">
        <div class="modal-content order-history-modal">
            <span class="close-modal" id="closeOrderHistoryModal">&times;</span>
            <h2>üìã My Orders</h2>
            
            <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <button class="order-filter-btn active" data-filter="all">All Orders</button>
                <button class="order-filter-btn" data-filter="cash">Cash Orders</button>
                <button class="order-filter-btn" data-filter="qr">QR Orders</button>
            </div>

            <div id="orderHistoryList" style="max-height: 500px; overflow-y: auto;">
                <!-- Orders will be loaded here -->
            </div>

            <div id="noOrdersMessage" style="text-align: center; padding: 2rem; color: #999;">
                <p style="font-size: 1.1rem;">üì≠ No orders yet</p>
                <p style="font-size: 0.9rem; margin-top: 0.5rem;">Start ordering to see your order history</p>
            </div>

            <button id="closeOrderHistoryBtn" class="btn-primary" style="width: 100%; margin-top: 1rem;">Close</button>
        </div>
    </div>

    <!-- Password Modal for Admin -->
    <div id="passwordModal" class="modal">
        <div class="modal-content">
            <h2>Enter Admin Password</h2>
            <input type="password" id="adminPassword" placeholder="Password" autofocus>
            <div class="modal-actions">
                <button id="submitPasswordBtn" class="btn-primary">Submit</button>
                <button id="cancelPasswordBtn" class="btn-secondary">Cancel</button>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>

